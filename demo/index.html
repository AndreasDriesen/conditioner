<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">

    <title>Conditioner - Detangle your JavaScript and make it shine.</title>

    <link href="css/rainbow/github.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <script>

        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-33378673-2', 'github.io');
        ga('send', 'pageview');

    </script>

</head>
<body>

<h1 class="logo">conditioner.js</h1>
<em>Conditionally Loading RequireJS Modules</em>

<!--
<div class="git">
<iframe src="http://ghbtns.com/github-btn.html?user=rikschennink&repo=conditioner&type=watch&count=true"
        allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
</div>
-->

<nav class="index">
    <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#requirements">Requirements</a></li>
        <li><a href="#documentation">Documentation</a></li>
        <li><a href="#examples">Examples</a></li>
        <li><a href="#license">License</a></li>
    </ul>
</nav>

<h2 id="introduction">Introduction</h2>


<p>Conditioner.js is a JavaScript Module Loader based on <a href="http://requirejs.org">RequireJS</a>. Conditioner.js allows you to define conditions under which your JavaScript modules are allowed to be loaded and than takes care of loading them at the right moment.</p>

<p>Suppose you have a Google Maps module which transforms an anchor to a full blown Google Map. It would make sense to only activate the maps module if there's enough real estate on the screen to render a decent sized map.</p>

<p>The following HTML snippet shows how to setup the Google Map using Conditioner.js. There are two things going on, the Map module is bound using the <code>data-module</code> attribute and the required conditions are set via the <code>data-conditions</code> attribute.</p>

<pre><code data-language="html">&lt;a href="http://maps.google.com/?ll=51.741,3.822"
   data-module="ui/Map"
   data-conditions="media:{(min-width:30em)}"&gt;
   ...
&lt;/a&gt;</code></pre>

<p>Now the HTML is setup, we only have to tell the Conditioner to look for modules in a certain section of the DOM and we're done. We can do this using the <code>loadModules</code> method.</p>

<pre><code data-language="javascript">conditioner.loadModules(document);</code></pre>

<p>You could say:</p>

<blockquote>Why not just put that Media Query test in my Google Map module?</blockquote>

<p>And of course that would work, at first.</p>

<p>As your project grows you might want to use the module on another page under different circumstances. So you add another Media Query check, and then another, and another.</p>

<p>Your modules should, most of the time, not be concerned with the environment they are in. This is where Conditioner.js comes into play. Conditioner.js will handle the environment and will initialize your module when the environment is suitable.</p>

<p>Because Conditioner.js takes care of initializing and loading modules. Modules all live separate from each other on their own little island (local scope). This makes expanding and maintaining the your project much easier since Modules are not strongly coupled.</p>


<h2 id="requirements">Requirements</h2>

<ul>
    <li><a href="http://requirejs.org" title="RequireJS - A JavaScript Module Loader"></a>RequireJS</li>
    <li>IE8 or better yet a modern browser</li>
</ul>





<section class="doc-group">
<h2 id="documentation">Documentation</h2>

<nav class="sub">
    <ul>
        <li><a href="#data-module">Binding modules</a></li>
        <li><a href="#data-conditions">Setting conditions</a></li>
        <li><a href="#data-options">Passing options</a></li>
        <li><a href="#data-priority">Defining priorities</a></li>
        <li><a href="#javascript-api">JavaScript API</a></li>
    </ul>
</nav>

<p>Linking your modules to the DOM is done through data attributes.</p>
<p>Note that in the following examples the <code>href</code> attribute has been ommited for clarity.</p>




<h3 id="data-module">Binding modules</h3>
<p>The string contained in the <code>data-module</code> attribute points to the location of the module.</p>

<pre><code data-language="html">&lt;a data-module="ui/Map"&gt; ... &lt;/a&gt;</code></pre>

<p>You can also use a shortcut name, should the module path change you would only have to change it at one location.</p>

<pre><code data-language="javascript">conditioner.setOptions({
    'modules':{
        'ui/Map':'IMap'
    }
});
</code></pre>

<p>The <code>data-module</code> attribute would now look like this:</p>

<pre><code data-language="html">&lt;a data-module="IMap"&gt; ... &lt;/a&gt;</code></pre>




<h3 id="data-conditions">Setting conditions</h3>
<p>The <code>data-conditions</code> attributes allows you to control the conditions under which a module is loaded. For instance, below is an example condition which only loads the module if the supplied media query is matched.
</p>

<pre><code data-language="html">&lt;a data-module="ui/Map" data-conditions="media:{(min-width:30em)}"&gt; ... &lt;/a&gt;</code></pre>

<p>Tests are formatted like this: <code>&lt;test_name&gt;:{&lt;expected_value&gt;}</code></p>

<h4>Writing expressions</h4>

<p>Conditioner.js allows combining of tests to build more complex conditions.</p>

<p>Link multiple tests using the <code>and</code> or <code>or</code> operators:</p>
<pre><code>foo:{bar} or foo:{bar} and foo:{bar}</code></pre>

<p>Group tests using brackets to override operator precedence: </p>
<pre><code>foo:{bar} or (foo:{bar} and foo:{bar})</code></pre>

<p>Use the <code>not</code> operator to negate a test or test group:
<pre><code>not (foo:{bar} or foo:{bar}) and not foo:{bar}</code></pre>





<h3 id="data-options">Passing options</h3>

<p>The <code>data-options</code> attribute allows you to set specific options to be passed to the Module when it's loaded.</p>

<p>Conditioner.js will merge page level options with node level options and pass the result to the Module once it's loaded.</p>

<pre><code data-language="html">&lt;a data-module="ui/Map" data-options='{"zoom":10}'&gt; ... &lt;/a&gt;</code></pre>

<pre><code data-language="javascript">conditioner.setOptions({
    'modules':{
        'ui/Map':{
            'options':{
            'zoom':5
            }
        }
    }
});</code></pre>

<p>In the (not so exciting) example above the resulting option object would be <code>{"zoom":10}</code>, since node level options take precendence over page level options zoom level <code>10</code> overwrites zoom level <code>5</code>.</p>




<h3 id="data-priority">Defining priorities</h3>

<p>The <code>data-priority</code> attributes allows you to control the order in which a node is handled. Positive numbers give a node priority over other nodes, a negative number moves it to the back of the initialisation queue.</p>

<pre><code data-language="html">&lt;a data-module="ui/Map" data-priority="1"&gt; ... &lt;/a&gt;</code></pre>
</section>




<section class="doc-group">
<h3 id="javascript-api">JavaScript API</h3>

<p>Conditioner.js consists of a group of publicly accessible JavaScript Classes. These Classes allow you to access modules once they've been parsed. The starting point to load modules is always the <code>conditioner</code> object of which there is only one instance.</p>

<nav class="sub code">
    <ul>
        <li><a href="#conditioner">conditioner</a>: object</li>
        <li><a href="#node">Node</a>: Class</li>
        <li><a href="#module-controller">ModuleController</a>: Class</li>
        <li><a href="#module">Module</a>: Class</li>
    </ul>
</nav>




<section class="doc-group">

<h4 id="conditioner">conditioner</h4>
<p>Call <code>loadModules(document)</code> on the conditioner object to start loading the modules defined in the HTML document. Once this is done the conditioner will return the array of
    Nodes it found and will initialize the once that are ready.</p>

<p>Each <a href="#node">Node</a> contains one or more ModuleControllers, for each Node only one <a href="#module-controller">ModuleController</a> can have an active
    <a href="#module">Module</a>.</p>

<p>The following methods are available on the conditioner object.</p>

<nav class="sub code">
    <ul>
        <li><a href="#conditioner-set-options">setOptions(object)</a></li>
        <li><a href="#conditioner-load-modules">loadModules(context)</a> &rarr; Array</li>
        <li><a href="#conditioner-get-node">getNode(selector)</a> &rarr; <a href="#node">Node</a>| null</li>
        <li><a href="#conditioner-get-nodes-all">getNodesAll(selector)</a> &rarr; Array</li>
    </ul>
</nav>

<h5 id="conditioner-set-options">setOptions</h5>
<p>Allows defining of page level Module options and shortcuts to modules.</p>
<pre><code data-language="javascript">/**
 * Set conditioner options
 * @param {object} options
 * @public
 */
conditioner.setOptions({
    'modules':{
        'ui/Clock':'IClock',
        'ui/Map':{
            'alias':'IMap',
            'options':{
                'zoom':10
            }
        }
    }
});</code></pre>



<h5 id="conditioner-load-modules">loadModules</h5>
<p>Finds and loads all Modules defined on child elements of the supplied context. Returns an array of found Nodes.</p>
<pre><code data-language="javascript">/**
 * Loads modules found within the given context
 * @param {element} context - Context to search for modules
 * @return {Array} - Array of found Nodes
 */
conditioner.loadModules(context);</code></pre>



<h5 id="conditioner-get-node">getNode</h5>
<p>Returns a single Node matching the supplied selector.</p>
<pre><code data-language="javascript">/**
 * Returns the first Node matching the selector
 * @param {string} selector - Selector to match the nodes to
 * @return {Node} First matched node
 */
conditioner.getNode(selector);</code></pre>



<h5 id="conditioner-get-nodes-all">getNodesAll</h5>
<p>Returns an Array of found Nodes matching the supplied selector.</p>
<pre><code data-language="javascript">/**
 * Returns all nodes matching the selector
 * @param {string} selector - Optional selector to match the nodes to
 * @return {Array} Array containing matched nodes
 */
conditioner.getNodesAll(selector);</code></pre>

</section>


<section class="doc-group">
<h4 id="node">Node</h4>

<p>For each element found having a <code>data-module</code> attribute an object of type Node is made. The node object can then be queried for the ModuleControllers it contains.</p>

<nav class="sub code">
    <ul>
        <li><a href="#node-get-active-module-controller">getActiveModuleController</a> &rarr; <a href="#module-controller">ModuleController</a>| null</li>
        <li><a href="#node-get-module-controller-by-path">getModuleControllerByPath</a> &rarr; <a href="#module-controller">ModuleController</a>| null</li>
        <li><a href="#node-get-module-controller-all-by-path">getModuleControllersByPath</a> &rarr; Array</li>
        <li><a href="#node-matches-selector">matchesSelector</a> &rarr; boolean</li>
        <li><a href="#node-execute">execute</a> &rarr; object</li>
    </ul>
</nav>

<h5 id="node-get-active-module-controller">getActiveModuleController</h5>
<p>Returns a reference to the currently active ModuleController.</p>
<pre><code data-language="javascript">/**
 * Returns a reference to the currently active module controller
 * @return {ModuleController}
 * @public
 */
node.getActiveModuleController();</code></pre>


<h5 id="node-get-module-controller-by-path">getModuleControllerByPath</h5>
<p>Finds and returns the first module to match the supplied path.</p>
<pre><code data-language="javascript">/**
 * Returns the first module controller matching the given path
 * @param path {string} path to module
 * @return {ModuleController}
 * @public
 */
node.getModuleControllerByPath(path);</code></pre>


<h5 id="node-get-module-controller-all-by-path">getModuleControllerAllByPath</h5>
<p>Finds all ModuleControllers matching the supplied path and returns them as an array.</p>
<pre><code data-language="javascript">/**
 * Returns an array of ModuleControllers matching the given path
 * @param path {string} path to module
 * @return {Array}
 * @public
 */
node.getModuleControllerAllByPath(path);</code></pre>


<h5 id="node-matches-selector">matchesSelector</h5>
<p>Tests if the element contained in the Node object matches the supplied CSS selector.</p>
<pre><code data-language="javascript">/**
 * Public method to check if the module matches the given query
 * @param {string} selector
 * @return {boolean}
 * @public
 */
node.matchesSelector(selector);</code></pre>


<h5 id="node-execute">execute</h5>
<p>Safely tries to executes a method on the currently active Module. Always returns an object containing a status code and a response data property.</p>
<pre><code data-language="javascript">/**
 * Public method for safely executing methods on the loaded module
 * @param {string} method - method key
 * @param {Array} params - array containing the method parameters
 * @return {object} returns object containing status code and possible response data
 * @public
 */
node.execute(method,[params]);</code></pre>

</section>




<section class="doc-group">

<h4 id="module-controller">ModuleController</h4>

<p>The ModuleController loads and unloads the contained Module based on the conditions received. It propagates events from the contained Module so you can safely subscribe to them.</p>
<nav class="sub code">
    <ul>
        <li><a href="#module-controller-matches-path">matchesPath</a> &rarr; boolean</li>
        <li><a href="#module-controller-is-active">isActive</a> &rarr; boolean</li>
        <li><a href="#module-controller-load">load</a></li>
        <li><a href="#module-controller-unload">unload</a> &rarr; boolean</li>
        <li><a href="#module-controller-execute">execute</a> &rarr; object</li>
    </ul>
</nav>

<h5 id="module-controller-matches-path">matchesPath</h5>
<p>Returns true if the ModuleController is in charge of a module with the given path.</p>
<pre><code data-language="javascript">/**
 * Checks if the module matches the path
 * @param {string} path - path of module to test for
 * @return {boolean} if matched
 * @public
 */
moduleController.matchesPath(path);</code></pre>

<h5 id="module-controller-is-active">isActive</h5>
<p>Returns true if the module contained within the ModuleController is currently loaded.</p>
<pre><code data-language="javascript">/**
 * Returns true if module is currently active and loaded
 * @returns {boolean}
 * @public
 */
moduleController.isActive();</code></pre>

<h5 id="module-controller-load">load</h5>
<p>Loads the Module if it's available (if conditions suitable). Publishes the 'load' event once finished.</p>
<pre><code data-language="javascript">/**
 * Load the module contained in this ModuleController
 * @public
 * @fires load
 */
moduleController.load();</code></pre>

<h5 id="module-controller-unload">unload</h5>
<p>Unloads the Module if it's not already unloaded. Publishes the 'unload' event once done.</p>
<pre><code data-language="javascript">/**
 * Unloads the Module
 * @fires unload
 * @return {boolean}
 * @public
 */
moduleController.unload();</code></pre>

<h5 id="module-controller-execute">execute</h5>
<p>Safely tries to execute a method on the module contained within the ModuleController.</p>
<pre><code data-language="javascript">/**
 * Executes a methods on the loaded module
 * @param {string} method - method key
 * @param {Array} params - optional array containing the method parameters
 * @return {object} containing response of executed method and a status code
 * @public
 */
moduleController.execute(method,[params]);</code></pre>

</section>



<section class="doc-group">

<h4 id="module">ModuleBase</h4>

<nav class="sub code">
    <ul>
        <li><a href="#module-constructor">constructor</a> &rarr; <a href="#module">module</a></li>
        <li><a href="#module-unload">unload</a></li>
    </ul>
</nav>



<h5>Constructor</h5>
<p>The ModuleBase contructor takes two parameters, an element and an optional options object.</p>
<p>ModuleBase is an abstract Class, UI Modules used in the framework should inherit from this Class.</p>
<pre><code data-language="javascript">/**
 * @class
 * @constructor
 * @param {element} element - DOM Element to apply this behavior to
 * @param {object} options - Custom options to pass to this behavior
 * @abstract
 */
ModuleBase.call(this,element,options);</code></pre>


<h5>Unload</h5>
<p>The <code>ModuleController</code> will call the <code>unload</code> method once the conditions for the Module are no longer valid. Use this method to clean up events attached by the Module and restore the original element state.</p>

<pre><code data-language="javascript">/**
 * Unloads module by removing data initialized property
 * Override to clean up your module.
 * @public
 */
module.unload();</code></pre>

</section>

</section>














<h2 id="examples">Examples</h2>

<!--
<p>Some examples on how to setup and use the framework.</p>
<nav class="sub">
    <ul>
        <li><a href="examples/setup/">Default setup</a></li>
        <li><a href="examples/conditions/">How to use Conditions</a></li>
        <li><a href="examples/expressions/">How to use Expressions</a></li>
        <li><a href="examples/custom/">Setting up Custom Conditions</a></li>
    </ul>
</nav>
-->

<h3>Always enabled</h3>
<p>Clock will be always be active.</p>
<pre><code data-language="html">&lt;div data-module="IClock"&gt; ... &lt;/div&gt;</code></pre>
<div class="component">
    <div data-module="IClock">Clock is inactive</div>
</div>


<h3>Based on Element dimensions</h3>
<p>Clock will be active as long as the element has a minimum width of 350 pixels.</p>
<pre><code data-language="html">&lt;div data-module="IClock" data-conditions="element:{min-width:350}"&gt; ... &lt;/div&gt;</code></pre>
<div class="component alt">
    <div data-module="IClock"
         data-conditions="element:{min-width:350}">Clock is inactive</div>
</div>


<h3>Based on multiple window dimensions</h3>
<p>Clock will be active as long as window width falls between 450 and 750 pixels. Priority of this component has a value of 1 which causes it to be loaded before all components without and explicit priority.</p>
<pre><code data-language="html">&lt;div data-module="IClock" data-conditions="window:{min-width:450} and window:{max-width:750}" data-priority="1"&gt; ... &lt;/div&gt;</code></pre>
<div class="component">
    <div data-module="IClock"
         data-priority="1"
         data-conditions="window:{min-width:450} and window:{max-width:750}">Clock is inactive</div>
</div>


<h3>Based on Media Query</h3>
<p>Clock will be active as long as media the media query is matched. Priority of this component has a value of minus 1, which causes it to be loaded after all components without and explicit priority have loaded.</p>
<pre><code data-language="html">&lt;div data-module="IClock" data-priority="-1" data-conditions="media:{(min-width:30em) and (max-width:60em)} or not media:{supported}"&gt; ... &lt;/div&gt;</code></pre>
<div class="component">
    <div data-module="IClock"
         data-priority="-1"
         data-conditions="media:{(min-width:30em) and (max-width:60em)} or not media:{supported}">Clock is inactive</div>
</div>

<h3>Based on the availability of a pointer device</h3>
<p>Clock will be active as long as we can detect the user has a pointer device.</p>
<pre><code data-language="html">&lt;div data-module="IClock" data-conditions="pointer:{available}"&gt; ... &lt;/div&gt;</code></pre>
<div class="component">
    <div data-module="IClock"
         data-conditions="pointer:{available}">Clock is inactive</div>
</div>


<h3>Based on multiple conditions</h3>
<p>Map will be active as long as there is any network connection, the media query is matched and the element is in view. If there is no media query support, the map may also be loaded.</p>
<pre><code data-language="html">&lt;div data-module="IMap" data-priority="2" data-conditions="(connection:{any} and media:{(min-width:40em)} and element:{seen}) or not media:{supported}"&gt; ... &lt;/div&gt;</code></pre>
<div class="component">
    <a href="http://maps.google.com/?ll=51.741380,3.822169&z=11"
         data-module="IMap"
         data-priority="2"
         data-conditions="(connection:{any} and media:{(min-width:40em)} and element:{seen}) or not media:{supported}">Coast of Holland at Google Maps</a>
</div>


<h3>Based on custom conditions</h3>
<p>The first Clock will be activated the moment all cookies are allowed. The second Clock is only inactive when the user accepts no cookies.</p>
<pre><code data-language="html">&lt;div data-module="IStorageConsentSelect" data-options='{"label":{"select":"Allow cookies"}}'&gt; ... &lt;/div&gt;</code></pre>
<div class="component">
    <div data-module="IStorageConsentSelect"
         data-options='{"label":{"select":"Allow cookies"}}'>
        Javascript needs to be enabled to control storage settings
    </div>
</div>
<pre><code data-language="html">&lt;div data-module="IClock" data-conditions="cookies:{all}"&gt; ... &lt;/div&gt;</code></pre>
<div class="component">
    <div data-module="IClock"
         data-conditions="cookies:{all}">Clock is inactive</div>
</div>
<pre><code data-language="html">&lt;div data-module="IClock" data-conditions="cookies:{all,incognito}"&gt; ... &lt;/div&gt;</code></pre>
<div class="component">
    <div data-module="IClock"
         data-conditions="cookies:{all,incognito}">Clock is inactive</div>
</div>


<h3>Multiple modules on a single element</h3>
<p>Clock will be active as long as element has a maximum width of 300 pixels, if the element width gets above 400 pixels another Clock becomes active which also shows the time.</p>
<pre><code data-language="html">&lt;div data-module='[{"path":"IClock","conditions":"element:{max-width:300}","options":{"time":false}},{"path":"IClock","conditions":"element:{min-width:400}"}]' data-priority="1"&gt; ... &lt;/div&gt;</code></pre>
<div class="component alt">
    <div data-module='[{"path":"IClock","conditions":"element:{max-width:300}","options":{"time":false}},{"path":"IClock","conditions":"element:{min-width:400}"}]' data-priority="1">Clock is inactive</div>
</div>


<h3>Binding both a conditioned and a wildcard module</h3>
<p>Clock will be active as long as element has a maximum width of 300 pixels, if the element gets above 300 pixels the wildcard Clock element is loaded which shows the time.</p>
<pre><code data-language="html">&lt;div data-module='[{"path":"IClock","conditions":"element:{max-width:300}","options":{"time":false}},{"path":"IClock"}]'&gt; ... &lt;/div&gt;</code></pre>
<div class="component alt">
    <div data-module='[{"path":"IClock","conditions":"element:{max-width:300}","options":{"time":false}},{"path":"IClock"}]'>Clock is inactive</div>
</div>



<h2 id="license">License</h2>
<p><a href="http://www.opensource.org/licenses/mit-license.php">MIT license</a></p>




<!-- For pretty javascript code examples -->
<script src="js/lib/ccampbell/rainbow/rainbow.min.js"></script>
<script src="js/lib/ccampbell/rainbow/html.js"></script>
<script src="js/lib/ccampbell/rainbow/generic.js"></script>
<script src="js/lib/ccampbell/rainbow/javascript.js"></script>


<!-- Shims to get this working on some older browsers <= IE9 (please minimize in real life) -->
<script src="js/shim/Array.isArray.js"></script>
<script src="js/shim/Array.indexOf.js"></script>
<script src="js/shim/Array.forEach.js"></script>
<script src="js/shim/Object.create.js"></script>
<script src="js/shim/Object.keys.js"></script>
<script src="js/shim/Function.bind.js"></script>
<script src="js/shim/matchMedia/matchMedia.js"></script>
<script src="js/shim/matchMedia/matchMedia.addListener.js"></script>

<!-- old stuff last, matchmedia won't be loaded if browser does not have addEventListener support, so we'll load shim now -->
<script src="js/shim/DOMContentLoaded.js"></script>
<script src="js/shim/addEventListener.js"></script>

<!-- Load minimized library (require + modules) -->
<script src="js.min/built.js"></script>



<script>

// setup requirejs
requirejs.config({
    baseUrl:'js/',
    paths:{
        conditioner:'../../dist/conditioner'
    }
});

// load conditioner
requirejs(['conditioner'],function(conditioner) {

        // setup modules
        conditioner.setOptions({
            'modules':{
                'ui/Map':'IMap',
                'ui/Clock':'IClock',
                'ui/StorageConsentSelect':{
                    'alias':'IStorageConsentSelect',
                    'options':{
                        'label':{
                            'level':{
                                'incognito':'Incognito'
                            }
                        }
                    }
                },
                'security/StorageConsentGuard':{
                    'options':{
                        'levels':['all','incognito','none'],
                        'initial':'none'
                    }
                }
            }
        });

        // load all modules found within the document scope
        conditioner.loadModules(document);

    }

);

</script>

</body>
</html>