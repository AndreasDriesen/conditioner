<!doctype html>
<html>
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <title>Conditioner Demo</title>
        <meta name="description" content="Conditioner Demo">
        <meta name="author" content="Rik Schennink">
        <meta name="viewport" content="width=device-width">

        <style>

            html {
                background:#fff;
                line-height:1.5;
                padding:2em;
                color:#999;
                overflow:scroll;
            }

            html,input,select,textarea,button {
                font-family:Helvetica,Verdana,sans-serif;
                font-size:1em;
            }

            h1 {
                font-size:1.5em;
                color:#333;
            }

            h2 {
                margin-top:1.5em;
                font-size:1.25em;
                color:#333;
            }

            h2+p {
                margin-top:-.75em;
            }

            p {
                max-width:30em;
            }

            .component {
                padding:1em;
                border:1px dotted #ccc;
            }

            img {
                display:block;
                max-width:100%;
            }

            label {
                margin-right:.5em;
            }

            label:after {
                content:':';
            }

        </style>

    </head>
    <body>

        <h1>Conditioner Demo</h1>

        <h2>Based on Element dimensions</h2>
        <p>ui.Clock will be active as long as element has a minimum width of 350 pixels.</p>
        <div class="component" style="width:60.00%">
            <div data-behavior="IClock" data-conditions='{"element":{"minWidth":350}}'>ui.Clock is inactive</div>
        </div>

        <h2>Based on the availability of a mouse</h2>
        <p>ui.Clock will be active as long as we can detect the user has a mouse.</p>
        <div class="component">
            <div data-behavior="IClock" data-conditions='{"mouse":true}'>ui.Clock is inactive</div>
        </div>

        <h2>Based on multiple Window dimensions</h2>
        <p>ui.ClearField will be active as long as window width falls between 450 and 750 pixels</p>
        <div class="component">
            <input type="text" data-behavior="IClearField" data-priority="1" data-conditions='{"window":{"minWidth":450,"maxWidth":750}}'>
        </div>

        <h2>Based on Media Query</h2>
        <p>ui.Clock will be active as long as media query (max-width:40em) is matched.</p>
        <div class="component">
            <div data-behavior="IClock" data-priority="-1" data-conditions='{"media":"(max-width:40em)"}'>ui.Clock is inactive</div>
        </div>

        <h2>Based on multiple conditions</h2>
        <p>ui.Map will be active as long as media query (min-width:40em) is matched and geolocation support is available. The ui.Map javascript file has not been included as a script reference and will only be loaded once the conditions are met.</p>
        <div class="component">
            <div data-behavior="IMap" data-priority="2" data-conditions='{"geolocation":true,"media":"(min-width:40em)"}'>ui.Map is inactive</div>
        </div>

        <h2>Based on custom Class conditions</h2>
        <p>ui.Clock will be active if cookies are allowed</p>
        <div class="component">
            <div data-behavior="IStorageConsent" data-options='{"label":{"select":"Allow cookies"}}'>
                Javascript needs to be enabled to control storage settings
            </div>
            <div data-behavior="IClock" data-conditions='{"cookies":["all","incognito"]}'>ui.Clock is inactive</div>
        </div>



        <!-- Shims -->
        <script src="js/shim/Bind.js"></script>
        <script src="js/shim/matchMedia/matchMedia.js"></script>
        <script src="js/shim/matchMedia/matchMedia.addListener.js"></script>

        <!-- Classes used by Conditioner -->
        <script src="js/helper/Namespace.js"></script>
        <script src="js/helper/Observer.js"></script>
        <script src="js/helper/ScriptLoader.js"></script>
        <script src="js/helper/Options.js"></script>

        <!-- Conditioner Classes -->
        <script src="js/conditioner/Injector.js"></script>
        <script src="js/conditioner/ConditionManager.js"></script>
        <script src="js/conditioner/BehaviorController.js"></script>
        <script src="js/conditioner/BehaviorBase.js"></script>
        <script src="js/conditioner/Conditioner.js"></script>

        <!-- Load default tests -->
        <script src="js/conditioner/Tests.js"></script>

        <!-- StorageConsentGuard Class is in use by StorageConsentSelect -->
        <script src="js/security/StorageConsentGuard.js"></script>

        <!-- UI Classes-->
        <script src="js/ui/ClearField.js"></script>
        <script src="js/ui/Clock.js"></script>
        <script src="js/ui/StorageConsentSelect.js"></script>

        <!-- Map Class will be loaded when necessary
        <script src="js/ui/Map.js"></script>
        -->



        <!-- Behavior start and configuration point -->
        <script>

            // Todo: look into generic condition where behavior is only loaded if other behavior is done loading
            // Todo: make used data attributes configurable
            // Todo: create base class for using multiple ui classes (with non overlapping conditions) on a single dom node
            // Todo: add class which renders window width (for testing purpose)
            // Todo: look into setting a singleton as a concrete class (how to handle getInstance method, what to do with testing)
            // Todo: look into performance
            // Todo: add more suitable example UI classes

            (function(){

                // configure your javascript file location
                Namespace.baseURL = 'js/';

                // get instance of conditioner
                var demo = Conditioner.getInstance();

                // register concrete classes
                demo.registerDependencies(
                    {
                        'id':'IClearField',
                        'uri':'ui.ClearField'
                    },
                    {
                        'id':'IMap',
                        'uri':'ui.Map'
                    },
                    {
                        'id':'IClock',
                        'uri':'ui.Clock'
                    },
                    {
                        'id':'IStorageConsent',
                        'uri':'ui.StorageConsentSelect',
                        'options':{
                            'label':{
                                'level':{
                                    'incognito':'No tracking'
                                }
                            }
                        }
                    },
                    {
                        'id':'IStorageGuard',
                        'uri':'security.StorageConsentGuard',
                        'options':{
                            'levels':['all','incognito','none'],
                            'initial':'none'
                        }
                    }
                );

                // register additional 'custom' test to handle cookie availability
                demo.registerTest(
                    'cookies',
                    function(handler) {
                        var guard = security.StorageConsentGuard.getInstance();
                        Observer.subscribe(guard,'change',function(state){handler(state);});
                        handler(guard.getActiveLevel());
                    },
                    function(current,expected) {
                        return expected.indexOf(current) > -1;
                    }
                );

                // wait till dom ready
                document.addEventListener('DOMContentLoaded',function() {
                    demo.applyBehavior(document);
                });

            }());

        </script>
    </body>
</html>